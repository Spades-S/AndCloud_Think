{% extends "./../basebar.html" %} {% block title %}历史列表{% endblock %} {% block headerbar %}
<link rel="stylesheet" href="/static/app/css/hwLayer.css">
<style>
    @media screen and (min-width: 760px) {
        .history-list {
            width: calc(50% - 3px);
            height: 100vh;
            display: inline-block;
            vertical-align: top;
        }
        .app-selected {
            width: calc(50% - 3px);
            display: inline-block;
            height: 100vh;
            overflow: auto;
            vertical-align: top;
        }
    }
    
    @media screen and (max-width: 760px) {
        .history-list {
            width: 100%;
            height: 50vh;
            display: inline-block;
            vertical-align: top;
        }
        .app-selected {
            width: 100%;
            display: inline-block;
            height: 50vh;
            overflow: auto;
            vertical-align: top;
        }
    }
    
    @media screen and (max-width: 760px) {
        .left-bar {
            width: 150px !important;
        }
    }
    
    .app-item {
        padding: 10px;
        height: 50px;
        box-sizing: content-box;
        cursor: pointer;
    }
    
    .app-item:hover {
        background: rgba(13, 21, 56, 0.10) !important;
    }
    
    .app-item.active {
        background: rgba(13, 21, 56, 0.16);
    }
    
    .app-item.odd {
        background: rgba(13, 21, 56, 0.06);
    }
    
    .app-item .logo {
        padding: 5px;
        height: 50px;
        width: 50px;
        float: left;
        /*position: absolute;*/
    }
    
    .app-item>div {
        /*padding-left: 70px;*/
        float: left;
        /*display: inline-block;*/
    }
    
    .history-list {
        position: relative;
    }
    
    .history-header {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 80px;
        background: rgba(13, 21, 56, 0.16);
    }
    
    .app {
        overflow: auto;
        height: 100%;
        padding-top: 80px;
    }
    
    .app span {
        font-weight: 100;
        font-size: 1.1em;
    }
    
    .list-enter-active,
    .list-leave-active {
        transition: all 1s;
    }
    
    .list-enter,
    .list-leave-active {
        opacity: 0;
        transform: translateY(-30px);
    }
    
    .bounce-enter-active {
        animation: bounce-in .5s;
    }
    
    .bounce-leave-active {
        animation: bounce-out .5s;
    }
    
    @keyframes bounce-in {
        0% {
            transform: scale(0);
        }
        50% {
            transform: scale(1.5);
        }
        100% {
            transform: scale(1);
        }
    }
    
    @keyframes bounce-out {
        0% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.5);
        }
        100% {
            transform: scale(0);
        }
    }
    
    .empty-page {
        text-align: center;
        float: left;
        margin-top: 50%;
        width: 100%;
        margin-left: auto;
        margin-right: auto;
    }
    
    .app-selected {
        padding: 50px;
    }
    
    .app-info-detail {}
    
    .app-info-detail .logo {
        width: 64px;
        height: 64px;
    }
    
    .app-info-detail .app-name {
        padding: 10px;
        border: 1px solid white;
        margin: 5px 0px;
        border-radius: 5px;
        text-align: center;
    }
    
    .app-info .info-title {
        border-radius: .25em;
        background-color: #5cb85c;
        font-size: 75%;
        font-weight: 700;
        padding: .1em .6em .1em;
        line-height: 1;
        text-align: center;
        white-space: nowrap;
        vertical-align: baseline;
        display: inline;
    }
    
    .app-info {
        margin: 2px;
        white-space: nowrap;
    }
    
    .button-btn {
        cursor: pointer;
        padding: 10px;
        border: 1px solid white;
        margin: 5px 0px;
        border-radius: 5px;
        text-align: center;
    }
    
    .info-hand {
        padding-bottom: 10px;
        border: 1px solid white;
        margin: 5px 0px;
        border-radius: 5px;
        text-align: center;
        overflow: hidden;
    }
    
    .infoblanket {
        position: relative;
        padding: 10px;
        border: 1px solid white;
        margin: 5px 0px;
        border-radius: 5px;
        display: flex;
        align-items: center;
    }
    
    .test-link {
        width: 68px;
        height: 68px;
        padding: 5px;
        background: rgba(30, 29, 39, 0.18);
        border-radius: 50px;
        text-align: center;
        padding-top: calc(50px - 1.4em);
    }
    
    .demo2 {
        transform-origin: center;
        transform: rotate(-90deg);
    }
    
    .mask {
        width: 110px;
        height: 110px;
        border-radius: 50%;
        left: 10px;
        top: 10px;
        position: absolute;
        text-align: center;
        line-height: 110px;
        font-size: 16px;
    }
    
    .fade-enter-active,
    .fade-leave-active {
        transition: opacity .5s
    }
    
    .fade-enter,
    .fade-leave-active {
        opacity: 0
    }
    
    .container {
        width: 100%;
        margin: 0 auto;
        padding: 0;
    }
    
    .bar-unfill {
        height: 30px;
        display: block;
        background: #fff;
        width: 100%;
    }
    
    .bar-fill {
        height: 30px;
        display: block;
        width: 0;
        background: #5cb85c;
        transition: width .8s ease;
    }
    /* Standard syntax */
    
    @keyframes progressbar {
        from {
            width: 10%
        }
        to {
            width: 100%
        }
    }
    
    .slide-fade-enter-active {
        transition: sliding-vertically .3s ease;
    }
    
    .slide-fade-leave-active {
        transition: sliding-vertically .8s cubic-bezier(1.0, 0.5, 0.8, 1.0);
    }
    
    .slide-fade-enter,
    .slide-fade-leave-active {
        transform: translateX(10px);
        opacity: 0;
    }
</style>
{% endblock %} {% block contentright %}

<div class="hw-overlay" id="hw-layer">
    <div class="hw-layer-wrap" style="background:#5cb85c;border: 1px solid white;overflow: auto;opacity: 0.8">
        <div class="row">
            <div class="col-md-3 col-sm-12">
                <p><b>And</b>Cloud</p>
                <p>Static Options</p>
            </div>
            <div class="col-md-9 col-sm-12">
                <div>
                    <h4>选择</h4>
                </div>
                <div style="margin:20px 0 20px;color:black">
                    <form>
                        <select name="version" id="version">
                            {% for item in mirrorlist %}
                            <option value="{{item.id}}">{{item.name}}</option>
                            {% endfor %}
                        </select>
                        <label for="version" style="color: white;font-weight: 100">Version</label>
                        <br/>
                        <select name="time" id="time">
                            <option value="5">5 mins</option>
                            <option value="10">10 mins</option>
                            <option value="15">15 mins</option>
                            <option value="120">2 hours</option>
                        </select>
                        <label for="time" style="color: white;font-weight: 100">Time</label>
                        <br/>
                    </form>
                </div>
                <div style="overflow: hidden">
                    <span style="float:left" class="button-btn confirm">确 定</span>
                    <span style="margin-left:5px;float:left" class="button-btn cancel">取 消</span>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="app" style="opacity: 0">
    <div class="history-list">
        <div class="history-header" style="z-index: 2">
            <h1 style="font-weight:100;padding-left: 10px">历史列表
                <transition name="bounce">
                    <p style="float:right" v-if="isLoading">Loading...</p>
                </transition>
            </h1>
        </div>
        <div class="app">
            <transition-group tag="p" v-bind:css="false" v-on:before-enter="beforeEnter" v-on:enter="enter" v-on:leave="leave">
                <template v-for="app,index in apps">
                    <div :class="{ active: index==selectedIndex, odd:index%2>0 }" class="app-item"
                         @click="select(index)" :key="index" :data-index="index">
                        <img :src="app.logo" alt="" class="logo">
                        <div style="">
                            <div>
                                <span><i class="iconfont icon-news_hot_light"></i></span> <span> {$app.label$}</span>
                            </div>
                            <div>
                                <span><i class="iconfont icon-time"></i> </span> <span> {$displayTime(app.created_time)$}</span>
                            </div>
                        </div>
                        <div style="clear:both;"></div>
                    </div>
                </template>
            </transition-group>
        </div>
    </div>
    <!--
    -->
    <div class="app-selected">
        <transition v-bind:css="false" v-on:before-enter="beforeEnter" v-on:enter="enter" v-on:leave="leave">
            <div v-if="selectedIndex == -1" v-bind:key="1">
                <div class="empty-page">
                    <div style="animation: buzz-out 3s infinite linear;">
                        <i class="iconfont icon-focus" style="font-size: 60px;margin:auto;"></i>
                    </div>
                    <br> 你啊，还没选择项目呢...
                    <br> 去左边选一个
                </div>
            </div>
            <div v-else v-bind:key="2">
                <div class="app-info-detail">
                    <div class="row">
                        <div class="col-xs-3">
                            <img :src="apps[selectedIndex].logo" alt="" class="logo">
                        </div>
                        <div class="col-xs-9">
                            <div v-if="!apps[selectedIndex].isfullinfo">正在检测，请稍后</div>
                            <div v-if="apps[selectedIndex].isfullinfo">
                                <div class="app-name">{$apps[selectedIndex].label$}</div>
                                <div class="app-info"><span class="info-title">包名</span> {$apps[selectedIndex].packagename$}
                                </div>
                                <div class="app-info"><span class="info-title">文件大小</span> {$(apps[selectedIndex].size/ 1024 / 1024).toFixed(2)$}MB
                                </div>
                                <div class="app-info"><span class="info-title">文件MD5</span> {$apps[selectedIndex].md5$}
                                </div>
                                <div class="app-info"><span class="info-title">文件SHA1</span> {$apps[selectedIndex].sha1$}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row" v-if="apps[selectedIndex].isfullinfo" style="text-align: center; margin-top: 3px;">
                        <div class="col-xs-3"></div>
                        <div class="col-xs-9">
                            <a class="button-btn pull-left iconfont icon-report" style="color:white; text-decoration:none; font-weight: 300;" v-bind:href="'/staticreport/index?id=' + apps[selectedIndex].id" target="view_window">APK静态分析报告
                            </a>
                        </div>
                    </div>
                    <hr>
                </div>
                <!--Waiting for implement-->
                <div class="app-action-list">
                    <div class="row">
                        <div v-if="apps[selectedIndex].isfullinfo === false">
                        </div>
                        <div v-else style="overflow: auto;padding: 12px;">
                            <div style="overflow: auto;margin: 15px auto;">
                                <div style="color:white;text-decoration: none;font-weight: 100;font-size: 1.5em;">
                                    自动检测
                                </div>
                            </div>


                            <div class="infoblanket">
                                <div class='process_bar' style="width: 30%;">
                                    <svg xmlns="http://www.w3.org/200/svg" height="110" width="110">
                                        <circle cx="55" cy="55" r="50" fill="none" stroke="white" stroke-width="5"
                                                stroke-linecap="round"/>
                                        <circle class="demo2" id="J_progress_bar" cx="55" cy="55" r="50" fill="none"
                                                stroke="#5cb85c" stroke-width="5" stroke-dasharray="157,10000"/>
                                    </svg>
                                    <div class="mask">{$autoPercentage$}</div>
                                </div>

                                <div class="test_info" style="width: 40%;text-align: center">
                                    <p>{$ autoToken.imageid $}</p>
                                    <p>存活时间：{$ autoToken.testTime $} min</p>
                                </div>

                                <div class="choose_button" style="width: 30%;text-align: center">
                                    <p>
                                        <a v-bind:href="'/runner/token/'+autoToken.token" style="cursor: pointer;color:white;text-decoration: none;font-weight: 100;font-size: 1.5em;margin-right:2%;text-align:right;">
                                            <i class="iconfont icon-creative test-link" style="font-size: 30px;padding-top:5px;"></i></a>
                                    </p>
                                    <transition name="fade">
<<<<<<< HEAD
                                        <p v-if='autoToken.isComplete' style="">
                                            <a v-bind:href="'/dynamicreport/index?id=' + autoToken.simulatorId" target="view_window"
                                               style="cursor: pointer;color:white;text-decoration: none;font-weight: 100;font-size: 1.5em;margin-right:2%;text-align:right;">
                                                <i class="iconfont icon-file test-link"
                                                   style="font-size: 30px;padding-top:5px;"></i></a>
=======
                                        <p v-if='autoComplete' style="">
                                            <a v-bind:href="'/dynamicreport/index?id=51'" target="view_window" style="cursor: pointer;color:white;text-decoration: none;font-weight: 100;font-size: 1.5em;margin-right:2%;text-align:right;">
                                                <i class="iconfont icon-file test-link" style="font-size: 30px;padding-top:5px;"></i></a>
>>>>>>> dev-s-
                                        </p>
                                    </transition>
                                </div>
                            </div>


                            <div style="overflow: auto;margin: 15px auto; display: flex; justify-content: space-between;align-items: center">
                                <div style="color:white;text-decoration: none;font-weight: 100;font-size: 1.5em;">
                                    手动检测
                                </div>
                                <div v-on:click="chooseTest" data-show-layer="hw-layer" style="cursor: pointer;color:white;text-decoration: none;font-weight: 100;font-size: 1.5em;">
                                    <i class="iconfont icon-repairfill test-link" style="font-size: 30px;padding-top:5px;"></i>
                                </div>

                            </div>

                            <div id="options">
                                <div class="info-hand" style="margin-bottom: 20px;cursor: auto;" v-for="(token,index) of handToken" :key="token">
                                    <div class="container">
                                        <div class="bar">
                                            <span class="bar-unfill">
                                                <span class="bar-fill" style="position: relative">
                                                    <span class="bar-percentage"
                                                          style="position: absolute;top:50%;left: 50%;transform: translate(-50%, -50%);"></span>
                                            </span>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="test_info" style="width:100%;text-align: center;margin: 0 auto;padding: 10px">
                                        <p>{$ token.imageid $}</p>
                                        <p>存活时间：{$ token.testTime $} min</p>
                                    </div>
                                    <a :href="'/runner/token/'+token.token" style="color:white;text-decoration: none;font-weight: 100;font-size: 1.5em"><i
                                            class="iconfont icon-creative test-link"
                                            style="font-size: 30px;padding-top:5px;"></i></a>
                                    <a v-on:click="terminateHandTest(token)" v-if="!(token.isComplete)" style="color:white;text-decoration: none;font-weight: 100;font-size: 1.5em;cursor: pointer"><i
                                            class="iconfont icon-stop test-link"
                                            style="font-size: 30px;padding-top:5px;"></i></a>
                                    <a v-bind:href="'/dynamicreport/index?id=' + token.simulatorId" target="view_window" v-if="token.isComplete"
                                       style="color:white;text-decoration: none;font-weight: 100;font-size: 1.5em;cursor: pointer"><i
                                            class="iconfont icon-file test-link"
                                            style="font-size: 30px;padding-top:5px;"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

    </div>
    </transition>
</div>
</div>
{% endblock %} {% block js %}
<script>
    var formatDate = function(date) {
        var y = date.getFullYear();
        var m = date.getMonth() + 1;
        m = m < 10 ? '0' + m : m;
        var d = date.getDate();
        d = d < 10 ? ('0' + d) : d;
        return y + '-' + m + '-' + d;
    };
    //展示层
    function showLayer(id) {
        var layer = $('#' + id),
            layerwrap = layer.find('.hw-layer-wrap');
        layer.slideToggle();
        //屏幕居中
        layerwrap.css({
            'margin-top': -layerwrap.outerHeight() / 2
        });
    }

    //隐藏层
    function hideLayer() {
        $('.hw-overlay').slideToggle();
    }

    $('.confirm').on('click', function() {
        hideLayer();
        //Wait for change
        //转成jQuery对象

        const projectid = $vm.apps[$vm.selectedIndex].id;
        let type = 0;
        let tokens = $vm.appTokens[projectid];
        for (var token of tokens) {
            if (token.type > type) {
                type = token.type;
            }
        }
        type++;
        let formData = new FormData();
        formData.append('type', type);
        formData.append('projectid', projectid);
        formData.append('vm', $('#version').val());
        formData.append('time', $('#time').val());
        $.ajax({
            url: '/project/uploadhandful',
            data: formData,
            method: 'POST',
            contentType: false,
            processData: false,
            success: data => {
                let token = data.data;
                $vm.handToken.push(token);
                $vm.appTokens[projectid][type] = token;
                $vm.handleHandToken();
            }
        })
    });
    $('.cancel').on('click', function() {
        hideLayer();
    });

    //点击或者触控弹出层外的半透明遮罩层，关闭弹出层
    $('.hw-overlay').on('click', function(event) {
        if (event.target == this) {
            hideLayer();
        }
    });

    //按ESC键关闭弹出层
    $(document).keyup(function(event) {
        if (event.keyCode == 27) {
            hideLayer();
        }
    });
</script>
<script src="/static/app/js/velocity.min.js"></script>
<script src="/static/app/js/moment-with-locales.js"></script>
<script>
    moment.locale('zh-CN');
    Vue.config.debug = true;
    Vue.config.silent = false;

    var $vm = new Vue({
        el: '#app',
        delimiters: ['{$', '$}'],
        data: {
            isLoading: true,
            selectedIndex: -1,
            apps: [],
            appTokens: {},
            autoToken: {},
            handToken: [],
            items: [1],
            autoPercentage: 0,
            autoComplete: false,
            autoInterval: undefined,
            handInterval: undefined,
        },
        methods: {
            getTokensEvt: function(projectid) {
                this.getTokens(projectid, (tokens) => {
                    this.autoToken = tokens[0];
                    this.handToken = tokens.slice(1);
                    //autoToken数据处理&&动画控制
                    if (this.autoInterval) {
                        clearInterval(this.autoInterval);
                    }
                    $.ajax({
                        url: "/project/getLifeCycle",
                        data: {
                            projectid: this.autoToken.projectid,
                            type: this.autoToken.type
                        },
                        method: "GET",
                        success: data => {
                            if (data.errno === 0) {
                                let simulator = data.data[0];
                                let createTime = Date.parse(simulator.createtime);
                                let deadlineTime = Date.parse(simulator.deadlinetime);
                                let totalTime = deadlineTime - createTime;
                                Vue.set($vm.autoToken, 'testTime', (totalTime / 1000 / 60).toFixed(2));
                                Vue.set($vm.autoToken, 'simulatorId', simulator.id);
                                if ((deadlineTime - new Date().getTime()) > 0) {
                                    Vue.set($vm.autoToken, 'isComplete', false);
                                } else {
                                    Vue.set($vm.autoToken, 'isComplete', true);
                                }
                                let nowTime = new Date().getTime();

                                let circle = $('#J_progress_bar');
                                let circleLength = Math.floor(2 * Math.PI * circle.attr('r'));

                                this.autoInterval = setInterval(() => {
                                    nowTime = new Date().getTime();
                                    let val = nowTime - createTime;
                                    val = Math.max(0, val);
                                    val = Math.min(totalTime, val);
                                    let percentage = Math.round((val / totalTime) * 100);
                                    if (percentage !== 100) {
                                        $vm.autoPercentage = Math.round((val / totalTime) * 100) + '%';
                                    } else {
                                        $vm.autoPercentage = '检测完成';
                                    }
                                    circle.attr('stroke-dasharray', "" + circleLength * (val / totalTime) + ', 10000');
                                    circle.attr('stroke', '#5cb85c');
                                    if (val === totalTime) {
                                        $vm.autoComplete = true;
                                        clearInterval(this.autoInterval);
                                        Vue.set($vm.autoToken, 'isComplete', true);
                                    }
                                }, 100);
                            } else {
                                $vm.autoPercentage = "无检测数据";
                                let circle = $('#J_progress_bar');
                                let circleLength = Math.floor(2 * Math.PI * circle.attr('r'));
                                circle.attr('stroke-dasharray', "" + circleLength + ', 10000');
                                circle.attr('stroke', 'red');
                            }
                        }
                    });

                    //handToken数据处理&&动画控制
                    this.handleHandToken();
                });
            },
            getTokens: function(projectid, success_callback) {
                if (this.appTokens[projectid] !== undefined) {
                    return success_callback(this.appTokens[projectid]);
                }
                $.ajax({
                    url: '/project/getTokens',
                    data: {
                        projectid: projectid
                    },
                    method: "POST",
                    success: data => {
                        if (data.errno !== 0) {
                            return alert(data.errmsg);
                        }
                        data.data.forEach($ => {
                            var projectid = $.projectid;
                            if (this.appTokens[projectid] === undefined) {
                                this.appTokens[projectid] = [];
                            }
                            this.appTokens[projectid][$.type] = $;
                        });
                        success_callback(this.appTokens[projectid]);
                    }
                });
            },
            handleHandToken: function() {
                setInterval(() => {
                    for (let token of this.handToken) {
                        let nowTime = new Date().getTime();
                        let val = nowTime - token.createTime;
                        if (token.isSet === false) {
                            token.isSet = true;
                            let leftTime = Math.round((token.totalTime - val) / 1000);
                            token.barFill.style.animation = 'progressbar ' + leftTime + 's 1 forwards';
                        }
                        let tick = setInterval(() => {
                            nowTime = new Date().getTime();
                            let val = nowTime - token.createTime;
                            val = Math.max(0, val);
                            val = Math.min(token.totalTime, val);
                            if (val !== token.totalTime) {
                                let percentage = Math.round((val / token.totalTime) * 100);
                                token.barPercentage.innerHTML = percentage + '%';
                            } else {
                                clearInterval(tick);
                                token.barPercentage.innerHTML = '检测完成';
                                Vue.set(token, 'isComplete', true);
                            }
                        }, 100);
                    }
                }, 1000);
                setTimeout(() => {
                    for (let i = 0; i < this.handToken.length; i++) {
                        $.ajax({
                            url: "/project/getLifeCycle",
                            data: {
                                projectid: this.handToken[i].projectid,
                                type: this.handToken[i].type
                            },
                            method: "GET",
                            success: data => {
                                if (data.errno === 0) {
                                    let simulator = data.data[0];
                                    let createTime = Date.parse(simulator.createtime);
                                    let deadlineTime = Date.parse(simulator.deadlinetime);
                                    let totalTime = deadlineTime - createTime;
                                    let barFill = $('.bar-fill')[i];
                                    let barPercentage = $('.bar-percentage')[i];

                                    Vue.set($vm.handToken[i], 'testTime', (totalTime / 1000 / 60).toFixed(2));
                                    Vue.set($vm.handToken[i], 'totalTime', totalTime);
                                    Vue.set($vm.handToken[i], 'createTime', createTime);
                                    Vue.set($vm.handToken[i], 'deadlineTime', deadlineTime);
                                    Vue.set($vm.handToken[i], 'simulatorId', simulator.id);
                                    if (($vm.handToken[i].deadlineTime - new Date().getTime()) > 0) {
                                        Vue.set($vm.handToken[i], 'isComplete', false);
                                    } else {
                                        Vue.set($vm.handToken[i], 'isComplete', true);
                                    }
                                    Vue.set($vm.handToken[i], 'barFill', barFill);
                                    Vue.set($vm.handToken[i], 'barPercentage', barPercentage);
                                    Vue.set($vm.handToken[i], 'isSet', false);
                                }
                            }
                        })
                    }
                }, 500)

            },
            getApkInfo: function(projid) {
                $.ajax({
                    url: '/project/apkinfo',
                    data: {
                        proj: projid
                    },
                    method: "GET",
                    success: data => {
                        var apkinfo = null;
                        if (!data.data || data.data.length == 0) {
                            console.log("projid" + projid + " not have apkinfo");
                            return;
                        }
                        apkinfo = data.data[0];
                        this.apps.forEach(function($) {
                            if ($.id === projid) {
                                if (apkinfo.id) {
                                    $.isfullinfo = true;
                                    for (var key in apkinfo) {
                                        if (key == 'id') continue;
                                        if (apkinfo.hasOwnProperty(key)) {
                                            $[key] = apkinfo[key];
                                        }
                                    }
                                } else {
                                    $.isfullinfo = false;
                                }
                            }
                        })
                    }
                });
            },
            select: function(index) {
                this.selectedIndex = index;
                this.getTokensEvt(this.apps[this.selectedIndex].id);
                this.getApkInfo(this.apps[this.selectedIndex].id);
            },
            displayTime: function(time) {
                return moment(time, 'YYYY-MM-DD HH:mm:ss').fromNow()
            },
            beforeEnter: function(el, done) {
                el.style.opacity = 0;
                var len = el.dataset.index * 50;
                $.Velocity(el, {
                    translateY: len + "px"
                }, {
                    complete: done
                });
                //                el.style.height = 0;
            },
            enter: function(el, done) {
                var delay = el.dataset.index * 150;
                setTimeout(function() {
                    $.Velocity(
                        el, {
                            opacity: 1,
                            translateY: "0px"
                        }, {
                            complete: done
                        }
                    )
                }, delay)
            },
            leave: function(el, done) {
                var delay = el.dataset.index * 150;
                setTimeout(function() {
                    $.Velocity(
                        el, {
                            opacity: 0,
                            translateY: "200px"
                        }, {
                            complete: done
                        }
                    )
                }, delay)
            },
            chooseTest: function() {
                var layerid = 'hw-layer';
                showLayer(layerid);
            },
            terminateHandTest: function(token) {
                $.ajax({
                    url: "/project/updateLifeCycle",
                    data: {
                        projectid: token.projectid,
                        type: token.type
                    },
                    method: "POST",
                    success: (data) => {
                        if (data.errno === 0) {
                            $vm.handleHandToken();
                            token.barFill.style.animation = 'progressbar 0s 1 forwards';
                        }
                    }
                })
            }
        },
        mounted: function() {
            $(this.$el).css('opacity', '1')
        },
    });
    $.ajax({
        url: "/project/getlist",
        success: data => {
            if (data.errno == 0) {
                var apps = data.data;
                setTimeout(() => {
                    $vm.isLoading = false;
                    $vm.apps = apps.map(function(app) {
                        app.created_time = app.uploadtime;
                        app.isfullinfo = false;
                        if (!app.label) {
                            app.label = "正在检测...";
                        }
                        if (!app.logo) {
                            app.logo = "/static/images/loading.gif";
                        }
                        return app;
                    });
                }, 100);
            }
        }
    });
</script>
{% endblock %}